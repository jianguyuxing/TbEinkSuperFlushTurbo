# TbEinkSuperFlushTurbo - 电子墨水屏残影清除工具

<div align="right">
  <strong>语言:</strong> 中文 | <a href="README_EN.md">English</a>
</div>

## 项目简介

TbEinkSuperFlushTurbo 是一款专为电子墨水屏设备设计的智能残影清除工具。通过DirectX GPU加速和智能区域检测算法，有效减少屏幕残影和闪烁，提供更佳的视觉体验。

### 🖥️ 主要目标设备
**本工具主要针对 ThinkBook Plus Gen4 (Twist) 的 Kaleido 彩色电子墨水屏开发和优化测试**，同时兼容其他电子墨水屏设备。

## 核心功能

### 🎯 智能残影清除
- **GPU加速处理**：利用DirectX 11和计算着色器进行高性能图像处理
- **图块化检测**：将屏幕划分为8x8像素图块，精确检测变化区域
- **智能刷新算法**：基于多帧稳定性检测，避免过度刷新

### 🚫 智能区域过滤
- **光标区域排除**：自动排除鼠标和文本光标周围区域（3个图块半径）
  - ⚠️ **限制说明**：仅支持标准Windows文本光标API，对于使用非标准光标API绘制的第三方应用光标可能无法检测
- **输入法候选栏检测**：智能识别并排除输入法候选栏区域
- **系统UI识别**：自动识别任务栏等系统UI区域

### ⚡ 性能优化
- **保护期机制**：刷新后的区块进入保护期，避免重复刷新
- **自适应阈值**：95%区域变化时触发重置，避免与系统刷新冲突
- **最小化干扰**：仅刷新必要区域，减少屏幕闪烁

### 🎨 可视化反馈
- **实时覆盖层**：刷新区域显示短暂的颜色覆盖（100ms）
- **托盘图标**：支持最小化到系统托盘
- **详细日志**：完整的操作日志和性能统计

## 技术特点

### 高级算法
- **多帧稳定性检测**：基于4帧平均窗口和3帧稳定要求
- **动态保护期**：根据覆盖层显示时间动态计算保护期
- **噪声过滤**：智能识别和过滤屏幕噪声

### DirectX集成
- **Vortice.DirectX**：使用现代.NET DirectX包装器
- **计算着色器**：GPU并行处理图像数据
- **高性能捕获**：低延迟屏幕捕获和处理

### 系统兼容性
- **高DPI支持**：自动适配不同DPI缩放设置
- **多架构支持**：支持x64架构
- **Windows 10/11**：专为现代Windows系统优化

## 使用方法

### 基本操作
1. 运行 `TbEinkSuperFlushTurbo.exe`
2. 点击 **Start** 按钮开始监控
3. 点击 **Stop** 按钮停止监控
4. 使用托盘图标控制显示/隐藏

### 高级设置
- 支持命令行参数配置
- 可自定义检测参数（图块大小、阈值等）
- 支持日志级别调整

## 系统要求

- **操作系统**：Windows 10 或更高版本
- **.NET版本**：.NET 8.0 或更高版本
- **显卡**：支持DirectX 11的显卡
- **权限**：建议以管理员权限运行以获得最佳效果
- **推荐设备**：ThinkBook Plus Gen4 (Twist) 或其他配备Kaleido电子墨水屏的设备

## 构建说明

### 开发环境
- Visual Studio 2022 或更高版本
- .NET 8.0 SDK
- Windows 10 SDK

### 依赖库
- Vortice.Direct3D11 (3.6.2)
- Vortice.DXGI (3.6.2)
- Vortice.D3DCompiler (3.6.2)

### 编译步骤
```bash
# 克隆项目
git clone [项目地址]

# 进入项目目录
cd TbEinkSuperFlushTurbo

# 还原依赖
dotnet restore

# 编译项目
dotnet build

# 运行项目
dotnet run
```

## 性能表现

### 检测性能
- **检测周期**：515ms（可配置）
- **处理延迟**：< 50ms
- **内存占用**：< 100MB

### 刷新优化
- **减少刷新次数**：相比传统方法减少60-80%
- **降低闪烁**：智能保护期机制
- **延长屏幕寿命**：最小化不必要的刷新操作

## 故障排除

### 故障排除

### 常见问题
1. **程序无法启动**：检查是否安装.NET 8.0运行时
2. **DirectX初始化失败**：更新显卡驱动程序
3. **检测不准确**：调整DPI设置或检测参数
4. **光标检测失败**：某些第三方应用使用非标准光标API，无法被检测

### 调试信息
- 查看 `Logs` 目录下的详细日志文件
- 检查 `debug_output.txt` 获取调试信息
- 使用Visual Studio调试器进行深度分析

## 更新日志

### 最新版本
- ✅ GPU加速图像处理
- ✅ 智能区域过滤
- ✅ 高DPI支持
- ✅ 托盘图标功能
- ✅ 详细日志系统

## 贡献指南

欢迎提交Issue和Pull Request来改进项目。在贡献前请：
1. 阅读项目文档和代码注释
2. 在本地测试所有更改
3. 遵循现有代码风格

## 许可证

本项目采用开源许可证，详见LICENSE文件。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 发送详细的问题描述和日志文件

---

**注意**：本工具专为电子墨水屏设备优化，在普通LCD/LED屏幕上可能看不到明显效果。建议在使用前关闭其他屏幕刷新工具以避免冲突。